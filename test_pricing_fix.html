<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Fixed Pricing Page JavaScript</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px; 
            line-height: 1.6;
        }
        .test-section { 
            background: #f5f5f5; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 8px; 
        }
        button { 
            background: #2563eb; 
            color: white; 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px;
        }
        .orange-btn {
            background: orange;
        }
        button:hover { opacity: 0.9; }
        .log { 
            background: #1f2937; 
            color: #10b981; 
            padding: 15px; 
            border-radius: 5px; 
            font-family: monospace; 
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üîß Pricing Page JavaScript Test</h1>
    <p>This page tests the fixed JavaScript functions from the pricing page.</p>
    
    <div class="test-section">
        <h2>üî• Test Button (Orange Button Fix)</h2>
        <p>This tests the orange test button functionality:</p>
        <button onclick="testButton('student')" class="orange-btn">üî• TEST BUTTON</button>
    </div>
    
    <div class="test-section">
        <h2>üí≥ Stripe Checkout Test</h2>
        <p>This tests the "Get Started" button functionality:</p>
        <button onclick="createCheckout('student', this)">Get Started - Student</button>
        <button onclick="createCheckout('growth', this)">Get Started - Growth</button>
        <button onclick="createCheckout('business', this)">Get Started - Business</button>
    </div>
    
    <div class="test-section">
        <h2>üìä Console Log Output</h2>
        <p>JavaScript console messages will appear here:</p>
        <div id="console-log" class="log">Loading JavaScript functions...\n</div>
        <button onclick="document.getElementById('console-log').innerHTML = 'Console cleared\\n';">Clear Log</button>
    </div>
    
    <script>
        // Capture console logs for display
        const logDiv = document.getElementById('console-log');
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        
        function addToLog(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ef4444' : '#10b981';
            logDiv.innerHTML += `<span style="color: ${color};">[${timestamp}] ${message}</span>\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToLog('ERROR: ' + args.join(' '), 'error');
        };
        
        // Copy the FIXED functions from main.py
        // Debug: Check if script is loading
        console.log('üî• PRICING: Script loaded successfully!');
        
        // Test function first - simpler implementation  
        function testButton(planType) {
            console.log('üî• TEST: Button clicked for plan:', planType);
            alert('‚úÖ SUCCESS! Button is working for plan: ' + planType);
            
            // Test fetch to ensure network connectivity
            fetch('/test-button/', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({plan: planType, test: true, timestamp: new Date().toISOString()})
            })
            .then(function(response) { return response.json(); })
            .then(function(result) {
                console.log('üî• TEST: Server response:', result);
                alert('‚úÖ Server Response: ' + JSON.stringify(result, null, 2));
            })
            .catch(function(error) {
                console.error('üî• TEST: Error:', error);
                alert('‚ùå Network Error: ' + error.message);
            });
        }
        
        // Stripe Checkout Integration - Fixed version
        function createCheckout(planType, buttonElement) {
            console.log('üî• CHECKOUT: Function called with planType:', planType);
            
            // Get button element safely
            var button = buttonElement;
            if (!button && window.event && window.event.target) {
                button = window.event.target;
            }
            if (!button) {
                console.error('‚ùå CHECKOUT: No button element found');
                alert('Error: Could not find button element');
                return;
            }
            
            var originalText = button.textContent;
            
            // Show loading state
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            button.disabled = true;
            
            console.log('üî• CHECKOUT: Button loading state set');
            
            // Prepare checkout data - FIXED template string issue
            var checkoutData = {
                plan_type: planType,
                customer_email: '',
                success_url: window.location.origin + '/success?session_id={CHECKOUT_SESSION_ID}',
                cancel_url: window.location.origin + '/pricing'
            };
            
            console.log('üî• CHECKOUT: Request data:', checkoutData);
            
            fetch('/create-checkout-session/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(checkoutData)
            })
            .then(function(response) {
                console.log('üî• CHECKOUT: Response status:', response.status);
                return response.json();
            })
            .then(function(data) {
                console.log('üî• CHECKOUT: Response data:', data);
                
                if (data.success && data.checkout_url) {
                    console.log('üî• CHECKOUT: Redirecting to:', data.checkout_url);
                    window.location.href = data.checkout_url;
                } else {
                    var errorMsg = data.error || data.detail || 'Unknown error occurred';
                    alert('‚ùå Checkout Error: ' + errorMsg);
                    console.error('‚ùå CHECKOUT: Error:', data);
                }
            })
            .catch(function(error) {
                console.error('‚ùå CHECKOUT: Network error:', error);
                alert('‚ùå Connection Error: ' + error.message + '\n\nPlease check your internet connection and try again.');
            })
            .finally(function() {
                // Reset button state
                button.innerHTML = originalText;
                button.disabled = false;
                console.log('üî• CHECKOUT: Button state reset');
            });
        }
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üî• PRICING: DOM loaded, page ready');
            
            // Test that all functions are available
            if (typeof testButton === 'function') {
                console.log('‚úÖ testButton function available');
            } else {
                console.error('‚ùå testButton function missing');
            }
            
            if (typeof createCheckout === 'function') {
                console.log('‚úÖ createCheckout function available');
            } else {
                console.error('‚ùå createCheckout function missing');
            }
        });
        
        // Global error handler for debugging
        window.addEventListener('error', function(event) {
            console.error('üî• GLOBAL ERROR:', event.error);
            console.error('üî• ERROR DETAILS:', {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno
            });
        });
    </script>
</body>
</html>